<div class="row justify-content-between">
  <div class="col align-self-center text-right">
    <button class="btn btn-success m-2" (click)="saveDashboardState()">Salva</button>
  </div>
</div>
<!-- Gridster grid -->
<gridster [options]="options" class="bg-white">
  <!-- Earch grister-item is generated with *ngFor -->
  <gridster-item [item]="item" *ngFor="let item of dashboardWidgetsArray">
    <div class="card">
      <div class="card-body">
        <ndc-dynamic class="no-drag" [ndcDynamicComponent]="item.component" [ndcDynamicInputs]="item"
          [ndcDynamicOutputs]="outputs" (ndcDynamicCreated)="componentCreated($event)">
        </ndc-dynamic>
      </div>
    </div>
  </gridster-item>
</gridster>
<!-- modal start -->
<div bsModal #widgetParametersModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
  aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body" *ngIf="barChartWidgetParameters">
        <p>
          <strong>Widget:</strong> {{barChartWidgetParameters.widgetname}}
        </p>
        <form [formGroup]="widgetParametersForm" (ngSubmit)="onWidgetParametersFormSubmit()">
          <tabset>
            <!-- PROPERTIES -->
            <tab heading="PROPRIETA" id="tab1">
              <div formGroupName="Properties">
                <div class="form-group" *ngIf="barChartWidgetParameters.showcharttype">
                  <label for="charttype">Typo di Grafico</label><!-- Chart Type -->
                  <select class="form-control" id="charttype" formControlName="charttype">
                    <option *ngFor="let type of barChartWidgetParameters.charttypes | keyvalue; let i = index"
                      [attr.selected]="!i" [ngValue]="type.key">
                      {{ type.value }}
                    </option>
                  </select>
                </div>
                <div class="form-group" *ngIf="barChartWidgetParameters.showaggregationoption">
                  <label for="aggregationoption">Aggregazioni</label><!-- Aggregations -->
                  <select class="form-control" id="aggregationoption" formControlName="aggregationoption">
                    <option *ngFor="let option of barChartWidgetParameters.aggregationoptions | keyvalue; let i = index"
                      [ngValue]="option.key" [attr.selected]="!i">
                      {{ option.value }}
                    </option>
                  </select>
                </div>
                <div class="form-group" *ngIf="barChartWidgetParameters.showmeasure">
                  <label for="measure">Le misure</label><!-- Measure -->
                  <select class="form-control" id="measure" formControlName="measure">
                    <option *ngFor="let measure of barChartWidgetParameters.measures | keyvalue; let i = index"
                      [attr.selected]="!i" [ngValue]="measure.key">
                      {{ measure.value }}
                    </option>
                  </select>
                </div>
              </div>
            </tab>
            <!-- FILTERS -->
            <tab heading="FILTRI">
              <div formGroupName="Filters">
                <label for="">Contraente e Contratto</label>
                <perfect-scrollbar style="max-height: 260px;">
                <div *ngFor="let treeObj of treesArray; let i = index" >
                  <span [hidden]="treeObj.loaded" class="fa fa-spinner text-primary" style="padding-left: 35px; height: 35px;">loading..</span>
                  <ejs-treeview [hidden]="!treeObj.loaded"
                    #permissionsTree 
                    id="{{treeObj.elementId}}" 
                    [fields]='treeObj.settings' 
                    [showCheckBox]='true' 
                    [checkedNodes]="preSelectedNodes" 
                    (nodeChecked)='syncSelectedNodesArray($event, treeObj)' >
                  </ejs-treeview>
                </div>
                </perfect-scrollbar><br>
                <div class="form-group">
                  <label for="dateTypes">Tipi di data</label><!-- Date Type -->
                  <select class="form-control" id="dateTypes" formControlName="dateTypes"
                    (change)="customDateTypes($event)">
                    <option *ngFor="let datetype of barChartWidgetParameters.datetypes | keyvalue; let i = index"
                      [attr.selected]="!i" [ngValue]="datetype.value">
                      {{ datetype.value }}
                    </option>
                  </select>
                </div>
                <span *ngIf="showDateRangeInFilters">
                  <div class="form-group" *ngIf="barChartWidgetParameters.showdaterangefilter">
                    <!-- Date Range -->
                    <!-- <label for="daterange">Intervallo di date</label>
                    <input type="text" formControlName="daterange" placeholder="Pick Date Range" class="form-control"
                      bsDaterangepicker [bsConfig]="{ rangeInputFormat: 'MM/YYYY' }"> -->
                    <label for="daterange">Intervallo di date</label><br>
                    <div class="row">
                      <div class="col-md-6">
                        <label for="fromdate" style="text-align: center">From</label>
                        <form class="container1">
                          <input autocomplete="off" class="form-control" name="date" 
                          bsDatepicker [bsConfig]="{dateInputFormat: 'MM/YYYY',adaptivePosition: true}" 
                          (onShown)="fromCalendar($event)">
                          <!-- Result: <p>{{modelDate}}</p> -->
                        </form>
                      </div>
                      <div class="col-md-6">
                        <label for="todate">To</label>
                        <form class="container2">
                          <input autocomplete="off" class="form-control" name="date" 
                          bsDatepicker [bsConfig]="{dateInputFormat: 'MM/YYYY',adaptivePosition: true}" 
                          (onShown)="toCalendar($event)">
                          <!-- Result: <p>{{modelDate}}</p> -->
                        </form>
                      </div>
                    </div> 
                  </div>
                </span>
                <span *ngIf="showDateInFilters">
                  <div class="form-group" *ngIf="barChartWidgetParameters.showdatefilter">
                    <label for="date">Seleziona la data</label><!-- Select Date -->
                    <input type="text" formControlName="date" placeholder="Pick Date" class="form-control" bsDatepicker
                      [bsConfig]="{ dateInputFormat: 'MM/YYYY', minMode: 'month' }">
                  </div>
                </span>
                <span *ngIf="barChartWidgetParameters.showorganization">
                  <div *ngFor="let treeObj of treesArray; let i = index">
                    <span [hidden]="treeObj.loaded" class="fa fa-spinner text-primary"
                      style="padding-left: 35px; height: 35px;">loading..</span>
                    <ejs-treeview [hidden]="!treeObj.loaded" #permissionsTree id="{{treeObj.elementId}}"
                      [fields]='treeObj.settings' [showCheckBox]='true' [checkedNodes]="treeObj.checkedNodes"
                      (nodeChecked)='syncSelectedNodesArray($event, treeObj)'>
                    </ejs-treeview>
                  </div>
                </span>
              </div>
            </tab>
            <!-- HELP -->
            <tab heading="AIUTO">
              {{ helpText }}
            </tab>
            <!-- NOTE -->
            <tab heading="NOTA">
              <textarea placeholder="Enter Note" class="form-control" formControlName="Note">

                </textarea>
            </tab>
          </tabset>
          <div class="row justify-content-end mt-3">
            <div class="col-6 text-right">
              <!-- Apply -->
              <button type="submit" class="btn btn-outline-primary btn-sm px-4">
                <!-- <span class="fa fa-spinner fa-spin"></span>  -->
                Applicare
              </button>

              <!-- Cancel -->
              <a (click)="widgetParametersModal.hide()" role="button"
                class="btn btn-primary pointer-cursor btn-sm px-4">
                Annulla
              </a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- modal end -->